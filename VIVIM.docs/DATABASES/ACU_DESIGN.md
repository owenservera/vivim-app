# VIVIM Database: ACU Design Deep Dive

The **Atomic Chat Unit (ACU)** is the fundamental unit of knowledge in VIVIM. This document explains the data design behind it.

## 1. Content-Addressed ID
Unlike traditional databases that use incremental IDs or random UUIDs, the `AtomicChatUnit` ID is a **Deterministic Hash** (SHA3-256) of its content.

- **Benefit:** If two users capture the exact same snippet of code, they will generate the same ID. This allows for global deduplication and "universal citation" across the P2P network.

## 2. Relational vs. Graph
The ACU design uses a **Hybrid Model**:
- **Relational:** ACUs are linked to their source Conversation and Message for provenance (knowing *where* it came from).
- **Graph:** ACUs are linked to *each other* via `AcuLink` for semantic context (knowing *how* it relates to other things).

## 3. Storage Efficiency (JSONB)
Message `parts` are stored as JSONB.
- This allows for "Rich Blocks" (Mermaid diagrams, Tables, Latex) to be stored without schema migrations for every new AI UI feature.
- During ACU generation, these blocks are extracted and "promoted" to standalone ACUs if they meet quality thresholds.

## 4. Vector Support
The `embedding` field (`Float[]`) is designed to store high-dimensional vectors generated by models like `all-MiniLM-L6-v2`.
- This enables **Semantic Search**: finding "similar" knowledge nuggets even if they don't share exact keywords.
